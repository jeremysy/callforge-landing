name: Reply to Tweet

on:
  workflow_dispatch:
    inputs:
      tweet_url:
        description: 'Tweet URL to reply to'
        required: true
        type: string
      reply_text:
        description: 'Reply text'
        required: true
        type: string

jobs:
  reply:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: pip install tweepy

      - name: Post reply
        env:
          TWITTER_API_KEY: ${{ secrets.TWITTER_API_KEY }}
          TWITTER_API_SECRET: ${{ secrets.TWITTER_API_SECRET }}
          TWITTER_ACCESS_TOKEN: ${{ secrets.TWITTER_ACCESS_TOKEN }}
          TWITTER_ACCESS_SECRET: ${{ secrets.TWITTER_ACCESS_SECRET }}
        run: |
          python << 'EOF'
          import os
          import re
          import tweepy

          client = tweepy.Client(
              consumer_key=os.environ['TWITTER_API_KEY'],
              consumer_secret=os.environ['TWITTER_API_SECRET'],
              access_token=os.environ['TWITTER_ACCESS_TOKEN'],
              access_token_secret=os.environ['TWITTER_ACCESS_SECRET']
          )

          url = "${{ inputs.tweet_url }}"
          tweet_id = re.search(r'/status/(\d+)', url).group(1)
          reply_text = """${{ inputs.reply_text }}"""

          response = client.create_tweet(text=reply_text, in_reply_to_tweet_id=tweet_id)
          print(f"âœ… Reply posted: https://twitter.com/i/status/{response.data['id']}")
          EOF
